(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.puz = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Puz={})}(this,(function(t){"use strict";const e={9:" ",10:" ",13:" ",133:"",134:" ",135:" ",140:" ",142:" ",144:" ",145:" ",146:" ",147:" ",148:" ",150:" ",151:" ",154:" ",160:" ",161:"!",162:"cents",163:"Pounds",165:"Yen",167:"[Section sign]",169:"[Copyright symbol]",172:"",173:"",174:"[Registered trademark]",175:"",176:"degrees",177:"+/-",178:"2",180:"'",182:"[Pilcrow]",183:"*",185:"1",186:"degrees",188:"1/4",189:"1/2",190:"3/4",191:"?",192:"A",193:"A",194:"A",195:"A",196:"A",197:"A",198:"AE",199:"C",200:"E",201:"E",202:"E",203:"E",204:"I",205:"I",206:"I",208:"D",209:"N",210:"O",211:"O",212:"O",213:"O",214:"O",215:"*",216:"O",218:"U",220:"U",223:"B",224:"a",225:"a",226:"a",227:"a",228:"a",229:"a",230:"ae",231:"c",232:"e",233:"e",234:"e",235:"e",236:"i",237:"i",238:"i",239:"i",240:"o",241:"n",242:"o",243:"o",244:"o",245:"o",246:"o",247:"/",248:"o",249:"u",250:"u",251:"u",252:"u",257:"a",259:"a",261:"a",263:"c",268:"C",269:"c",275:"e",297:"i",304:"I",305:"i",322:"",324:"n",333:"o",338:"AE",339:"ae",345:"r",346:"S",351:"s",352:"S",353:"s",361:"u",363:"u",382:"z",402:"f",432:"u",464:"i",601:"e",621:"",624:"",628:"N",688:"h",690:"Palatalization",691:"r",695:"w",699:"'",701:"'",710:"^",738:"s",769:"",916:"[Greek letter delta]",919:"H",929:"P",931:"[Greek letter sigma]",937:"[Greek letter omega]",945:"Greek letter alpha",946:"[Greek letter beta]",948:"o",950:"",951:"[Greek Letter Eta]",952:"[Greek letter theta]",955:"[Greek letter lambda]",956:"u",957:"",958:"",960:"Pi",961:"p",964:"",967:"",968:"[Greek letter psi]",969:"w",1009:"g",1071:"R",2090:"",2934:"",3607:"",3611:"",3618:"",3619:"",3624:"",3632:"",3647:"[Thai Currency]",3648:"",3652:"",3725:"",3732:"",3738:"",3754:"",3760:"",3762:"",3765:"",6496:"",6503:"",6637:"",7335:"",7392:"",7491:"a",7497:"e",7511:"t",7512:"u",7584:"f",7589:"",7590:"x",7789:"t",7843:"a",7845:"a",7865:"e",7871:"e",7879:"e",7885:"o",7887:"o",7889:"o",7897:"o",7903:"",7909:"u",7911:"u",7921:"u",8195:" ",8200:" ",8201:" ",8203:"",8205:"",8209:"-",8211:"-",8212:"-",8216:"'",8217:"'",8220:'"',8221:'"',8224:"[Dagger]",8225:"[Dagger]",8226:"*",8230:"...",8239:" ",8240:"%",8242:"'",8243:'"',8270:"*",8288:"",8319:"n",8322:"2",8323:"3",8326:"6",8327:"7",8328:"8",8364:"Euro",8383:"Bitcoin",8463:"n",8482:"[Trademark symbol]",8592:"[Left Arrow]",8593:"[Up arrow]",8594:"[Right arrow]",8595:"[Down arrow]",8617:"[Leftwards Arrow with Hook]",8710:"[Triangle]",8722:"-",8730:"[Square root]",8734:"[Infinity]",8743:"[and]",8744:"[or]",8804:"<=",8964:"[Down Arrowhead]",8984:"[Looped Square]",8986:"[Watch]",9167:"[Eject]",9186:"[White Trapezium]",9194:"[Fast Reverse]",9200:"[Alarm Clock]",9203:"[Hourglass Not Done]",9208:"[Pause Button]",9634:"[Square with Rounded Corners]",9651:"[Triangle]",9654:"[Right Arrow]",9711:"[Large circle]",9728:"*",9730:"[Umbrella]",9733:"[Star]",9749:"[Hot Beverage]",9752:"[Shamrock]",9757:"[Index Pointing Up]",9758:"[Right Pointing]",9759:"[Down Pointing]",9760:"[Skull and Crossbones]",9774:"[Peace Symbol]",9775:"[Yin Yang]",9785:"[Frowning Face]",9786:"[Smiling Face]",9792:"[Female Sign]",9794:"[Male Sign]",9800:"[Aries]",9804:"[Leo]",9824:"[Spade]",9827:"[Club]",9829:"[Heart]",9830:"[Diamond]",9835:"[Beamed Eighth Notes]",9837:"[Flat]",9839:"[Sharp]",9851:"[Recycling Symbol]",9872:"[Flag]",9879:"Alembic",9881:"[Gear]",9883:"[Atom]",9888:"[Warning]",9895:"[Transgender Symbol]",9904:"[Coffin]",9918:"[Baseball]",9961:"[Shinto Shrine]",9973:"[Sailboat]",9975:"[Skier]",9986:"[Scissors]",9992:"[Airplane]",9993:"[Envelope]",9994:"[Raised Fist]",9996:"[V sign]",10014:"[Cross]",10052:"[Snowflake]",10067:"[Question Mark]",10084:"[Red Heart]",10145:"[Right Arrow]",11014:"[Up arrow]",11088:"[Star]",12356:"",12399:"",12484:"",19177:"",30820:"",30825:"",34864:"",35685:"",36005:"",36064:"",36077:"",38913:"",38924:"",38945:"",38948:"",38950:"",38959:"",38963:"",38964:"",39081:"",39200:"",39205:"",39264:"",39268:"",39411:"",39791:"",40101:"",40105:"",40161:"",40162:"",40181:"",40229:"",55308:"[Sparrow]",55356:"",55357:"[Astonished Face]",55358:"[Robot]",55622:"",55623:"",55639:"",56186:"",65038:"",65039:"",65533:""};var r=void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s=!1;function u(){s=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,r=t.length;e<r;++e)n[e]=t[e],i[t.charCodeAt(e)]=e;i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63}function a(t,e,r){for(var i,o,s=[],u=e;u<r;u+=3)i=(t[u]<<16)+(t[u+1]<<8)+t[u+2],s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}function l(t){var e;s||u();for(var r=t.length,i=r%3,o="",l=[],c=16383,f=0,h=r-i;f<h;f+=c)l.push(a(t,f,f+c>h?h:f+c));return 1===i?(e=t[r-1],o+=n[e>>2],o+=n[e<<4&63],o+="=="):2===i&&(e=(t[r-2]<<8)+t[r-1],o+=n[e>>10],o+=n[e>>4&63],o+=n[e<<2&63],o+="="),l.push(o),l.join("")}function c(t,e,r,n,i){var o,s,u=8*i-n-1,a=(1<<u)-1,l=a>>1,c=-7,f=r?i-1:0,h=r?-1:1,d=t[e+f];for(f+=h,o=d&(1<<-c)-1,d>>=-c,c+=u;c>0;o=256*o+t[e+f],f+=h,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+t[e+f],f+=h,c-=8);if(0===o)o=1-l;else{if(o===a)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=l}return(d?-1:1)*s*Math.pow(2,o-n)}function f(t,e,r,n,i,o){var s,u,a,l=8*o-i-1,c=(1<<l)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-s))<1&&(s--,a*=2),(e+=s+f>=1?h/a:h*Math.pow(2,1-f))*a>=2&&(s++,a/=2),s+f>=c?(u=0,s=c):s+f>=1?(u=(e*a-1)*Math.pow(2,i),s+=f):(u=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[r+d]=255&u,d+=p,u/=256,i-=8);for(s=s<<i|u,l+=i;l>0;t[r+d]=255&s,d+=p,s/=256,l-=8);t[r+d-p]|=128*g}var h={}.toString,d=Array.isArray||function(t){return"[object Array]"==h.call(t)};function p(){return m.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function g(t,e){if(p()<e)throw new RangeError("Invalid typed array length");return m.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=m.prototype:(null===t&&(t=new m(e)),t.length=e),t}function m(t,e,r){if(!(m.TYPED_ARRAY_SUPPORT||this instanceof m))return new m(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return w(this,t)}return y(this,t,e,r)}function y(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);m.TYPED_ARRAY_SUPPORT?(t=e).__proto__=m.prototype:t=E(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!m.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|A(e,r),i=(t=g(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(R(e)){var r=0|v(e.length);return 0===(t=g(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?g(t,0):E(t,e);if("Buffer"===e.type&&d(e.data))return E(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function b(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function w(t,e){if(b(e),t=g(t,e<0?0:0|v(e)),!m.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function E(t,e){var r=e.length<0?0:0|v(e.length);t=g(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function v(t){if(t>=p())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+p().toString(16)+" bytes");return 0|t}function R(t){return!(null==t||!t._isBuffer)}function A(t,e){if(R(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return X(t).length;default:if(n)return q(t).length;e=(""+e).toLowerCase(),n=!0}}function S(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,e,r);case"utf8":case"utf-8":return B(this,e,r);case"ascii":return z(this,e,r);case"latin1":case"binary":return D(this,e,r);case"base64":return L(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function I(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function T(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=m.from(e,n)),R(e))return 0===e.length?-1:O(t,e,r,n,i);if("number"==typeof e)return e&=255,m.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):O(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function O(t,e,r,n,i){var o,s=1,u=t.length,a=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,u/=2,a/=2,r/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var c=-1;for(o=r;o<u;o++)if(l(t,o)===l(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===a)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(r+a>u&&(r=u-a),o=r;o>=0;o--){for(var f=!0,h=0;h<a;h++)if(l(t,o+h)!==l(e,h)){f=!1;break}if(f)return o}return-1}function U(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var u=parseInt(e.substr(2*s,2),16);if(isNaN(u))return s;t[r+s]=u}return s}function P(t,e,r,n){return J(q(e,t.length-r),t,r,n)}function _(t,e,r,n){return J(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function C(t,e,r,n){return _(t,e,r,n)}function N(t,e,r,n){return J(X(e),t,r,n)}function k(t,e,r,n){return J(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function L(t,e,r){return 0===e&&r===t.length?l(t):l(t.slice(e,r))}function B(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,u,a,l=t[i],c=null,f=l>239?4:l>223?3:l>191?2:1;if(i+f<=r)switch(f){case 1:l<128&&(c=l);break;case 2:128==(192&(o=t[i+1]))&&(a=(31&l)<<6|63&o)>127&&(c=a);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(a=(15&l)<<12|(63&o)<<6|63&s)>2047&&(a<55296||a>57343)&&(c=a);break;case 4:o=t[i+1],s=t[i+2],u=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&u)&&(a=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&u)>65535&&a<1114112&&(c=a)}null===c?(c=65533,f=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=f}return function(t){var e=t.length;if(e<=$)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=$));return r}(n)}m.TYPED_ARRAY_SUPPORT=void 0===r.TYPED_ARRAY_SUPPORT||r.TYPED_ARRAY_SUPPORT,m.poolSize=8192,m._augment=function(t){return t.__proto__=m.prototype,t},m.from=function(t,e,r){return y(null,t,e,r)},m.TYPED_ARRAY_SUPPORT&&(m.prototype.__proto__=Uint8Array.prototype,m.__proto__=Uint8Array),m.alloc=function(t,e,r){return function(t,e,r,n){return b(e),e<=0?g(t,e):void 0!==r?"string"==typeof n?g(t,e).fill(r,n):g(t,e).fill(r):g(t,e)}(null,t,e,r)},m.allocUnsafe=function(t){return w(null,t)},m.allocUnsafeSlow=function(t){return w(null,t)},m.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Q(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Q(t.slice(0,0))}(t))},m.compare=function(t,e){if(!R(t)||!R(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},m.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},m.concat=function(t,e){if(!d(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return m.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=m.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!R(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},m.byteLength=A,m.prototype._isBuffer=!0,m.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)I(this,e,e+1);return this},m.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)I(this,e,e+3),I(this,e+1,e+2);return this},m.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)I(this,e,e+7),I(this,e+1,e+6),I(this,e+2,e+5),I(this,e+3,e+4);return this},m.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?B(this,0,t):S.apply(this,arguments)},m.prototype.equals=function(t){if(!R(t))throw new TypeError("Argument must be a Buffer");return this===t||0===m.compare(this,t)},m.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},m.prototype.compare=function(t,e,r,n,i){if(!R(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),u=Math.min(o,s),a=this.slice(n,i),l=t.slice(e,r),c=0;c<u;++c)if(a[c]!==l[c]){o=a[c],s=l[c];break}return o<s?-1:s<o?1:0},m.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},m.prototype.indexOf=function(t,e,r){return T(this,t,e,r,!0)},m.prototype.lastIndexOf=function(t,e,r){return T(this,t,e,r,!1)},m.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return U(this,t,e,r);case"utf8":case"utf-8":return P(this,t,e,r);case"ascii":return _(this,t,e,r);case"latin1":case"binary":return C(this,t,e,r);case"base64":return N(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},m.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;function z(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function D(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function x(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=K(t[o]);return i}function Y(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function j(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function G(t,e,r,n,i,o){if(!R(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function M(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function F(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function Z(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function V(t,e,r,n,i){return i||Z(t,0,r,4),f(t,e,r,n,23,4),r+4}function H(t,e,r,n,i){return i||Z(t,0,r,8),f(t,e,r,n,52,8),r+8}m.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),m.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=m.prototype;else{var i=e-t;r=new m(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},m.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||j(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},m.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||j(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},m.prototype.readUInt8=function(t,e){return e||j(t,1,this.length),this[t]},m.prototype.readUInt16LE=function(t,e){return e||j(t,2,this.length),this[t]|this[t+1]<<8},m.prototype.readUInt16BE=function(t,e){return e||j(t,2,this.length),this[t]<<8|this[t+1]},m.prototype.readUInt32LE=function(t,e){return e||j(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},m.prototype.readUInt32BE=function(t,e){return e||j(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},m.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||j(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},m.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||j(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},m.prototype.readInt8=function(t,e){return e||j(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},m.prototype.readInt16LE=function(t,e){e||j(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},m.prototype.readInt16BE=function(t,e){e||j(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},m.prototype.readInt32LE=function(t,e){return e||j(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},m.prototype.readInt32BE=function(t,e){return e||j(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},m.prototype.readFloatLE=function(t,e){return e||j(t,4,this.length),c(this,t,!0,23,4)},m.prototype.readFloatBE=function(t,e){return e||j(t,4,this.length),c(this,t,!1,23,4)},m.prototype.readDoubleLE=function(t,e){return e||j(t,8,this.length),c(this,t,!0,52,8)},m.prototype.readDoubleBE=function(t,e){return e||j(t,8,this.length),c(this,t,!1,52,8)},m.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||G(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},m.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||G(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},m.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,1,255,0),m.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},m.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,2,65535,0),m.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},m.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,2,65535,0),m.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},m.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,4,4294967295,0),m.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):F(this,t,e,!0),e+4},m.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,4,4294967295,0),m.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):F(this,t,e,!1),e+4},m.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);G(this,t,e,r,i-1,-i)}var o=0,s=1,u=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===u&&0!==this[e+o-1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+r},m.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);G(this,t,e,r,i-1,-i)}var o=r-1,s=1,u=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===u&&0!==this[e+o+1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+r},m.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,1,127,-128),m.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},m.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,2,32767,-32768),m.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},m.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,2,32767,-32768),m.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},m.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,4,2147483647,-2147483648),m.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):F(this,t,e,!0),e+4},m.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||G(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),m.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):F(this,t,e,!1),e+4},m.prototype.writeFloatLE=function(t,e,r){return V(this,t,e,!0,r)},m.prototype.writeFloatBE=function(t,e,r){return V(this,t,e,!1,r)},m.prototype.writeDoubleLE=function(t,e,r){return H(this,t,e,!0,r)},m.prototype.writeDoubleBE=function(t,e,r){return H(this,t,e,!1,r)},m.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!m.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},m.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!m.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=R(t)?t:q(new m(t,n).toString()),u=s.length;for(o=0;o<r-e;++o)this[o+e]=s[o%u]}return this};var W=/[^+\/0-9A-Za-z-_]/g;function K(t){return t<16?"0"+t.toString(16):t.toString(16)}function q(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function X(t){return function(t){var e,r,n,a,l,c;s||u();var f=t.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");l="="===t[f-2]?2:"="===t[f-1]?1:0,c=new o(3*f/4-l),n=l>0?f-4:f;var h=0;for(e=0,r=0;e<n;e+=4,r+=3)a=i[t.charCodeAt(e)]<<18|i[t.charCodeAt(e+1)]<<12|i[t.charCodeAt(e+2)]<<6|i[t.charCodeAt(e+3)],c[h++]=a>>16&255,c[h++]=a>>8&255,c[h++]=255&a;return 2===l?(a=i[t.charCodeAt(e)]<<2|i[t.charCodeAt(e+1)]>>4,c[h++]=255&a):1===l&&(a=i[t.charCodeAt(e)]<<10|i[t.charCodeAt(e+1)]<<4|i[t.charCodeAt(e+2)]>>2,c[h++]=a>>8&255,c[h++]=255&a),c}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(W,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function J(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Q(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var tt=function(t,e){return(tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};"function"==typeof SuppressedError&&SuppressedError;var et="Invariant Violation",rt=Object.setPrototypeOf,nt=void 0===rt?function(t,e){return t.__proto__=e,t}:rt,it=function(t){function e(r){void 0===r&&(r=et);var n=t.call(this,"number"==typeof r?et+": "+r+" (see https://github.com/apollographql/invariant-packages)":r)||this;return n.framesToPop=1,n.name=et,nt(n,e.prototype),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}tt(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error);function ot(t,e){if(!t)throw new it(e)}var st=["log","warn","error","silent"],ut=st.indexOf("log");function at(t){return function(){if(st.indexOf(t)>=ut)return console[t].apply(console,arguments)}}!function(t){t.log=at("log"),t.warn=at("warn"),t.error=at("error")}(ot||(ot={}));var lt,ct,ft=ot;function ht(t,e=0){return t.reduce(((t,e)=>{const r=1&t;return t>>>=1,(t|=r<<15)+e&65535}),e)}!function(t){t.UTF_8="utf-8",t.ISO_8859_1="latin1"}(lt||(lt={})),function(t){t[t.CIRCLED=128]="CIRCLED",t[t.REVEALED=64]="REVEALED",t[t.INCORRECT=32]="INCORRECT",t[t.PREVIOUSLY_INCORRECT=16]="PREVIOUSLY_INCORRECT",t[t.PENCILED=8]="PENCILED",t[t.UNKNOWN_04=4]="UNKNOWN_04",t[t.UNKNOWN_02=2]="UNKNOWN_02",t[t.UNKNOWN_01=1]="UNKNOWN_01"}(ct||(ct={}));const dt=["circled","incorrect","previouslyIncorrect","revealed","penciled","unknown_04","unknown_02","unknown_01"],pt="A".charCodeAt(0),gt=m.from([]),mt=m.from([0]),yt=m.from("ICHEATED","ascii"),bt="ACROSS&DOWN\0",wt=/[.:]/,Et=/^([ 0-9]\d:[a-zA-Z0-9@#$%&+?]*?;)*$/,vt=/^(\d+),([01])$/,Rt=/^(\d+)\.(\d+)([a-z])?$/,At=/^[.:A-Za-z0-9@#$%&+?]+$/,St=/^[-.:A-Za-z0-9@#$%&+?]+$/,It="1.4";function Tt(t="1.4"){ft(Rt.test(t),"file version data did not match expected format");const[,e,r,n]=Rt.exec(t);return[Number.parseInt(e),Number.parseInt(r),n]}function Ot(t){return null!=t?t+"\0":""}function Ut(t="1.4"){const[e]=Tt(t);return e>=2?lt.UTF_8:lt.ISO_8859_1}function Pt({title:t,author:e,copyright:r,clues:n,notepad:i,fileVersion:o}){const[s,u]=Tt(o);return Ot(t)+Ot(e)+Ot(r)+n.join("")+(s>=1&&u>=3?Ot(i):"")}function _t(t){var e,r,n,i,o,s,u,a,l;const c=m.alloc(52);return c.write(bt,2,"ascii"),c.write(null!==(e=t.fileVersion)&&void 0!==e?e:It,24,"ascii"),c.writeUInt16LE(null!==(n=null===(r=null==t?void 0:t.misc)||void 0===r?void 0:r.unknown1)&&void 0!==n?n:0,28),c.writeUInt16LE(null!==(o=null===(i=null==t?void 0:t.misc)||void 0===i?void 0:i.scrambledChecksum)&&void 0!==o?o:0,30),m.from(null!==(u=null===(s=null==t?void 0:t.misc)||void 0===s?void 0:s.unknown2)&&void 0!==u?u:mt).copy(c,32),c.writeUInt8(t.width,44),c.writeUInt8(t.height,45),c.writeUInt16LE(t.clues.length,46),c.writeUInt16LE(null!==(l=null===(a=null==t?void 0:t.misc)||void 0===a?void 0:a.puzzleFormat)&&void 0!==l?l:1,48),c.writeUInt16LE(t.isScrambled?4:0,50),c}function Ct(t,e){const r=m.alloc(8),n=ht(e);return r.write(t,0,"ascii"),r.writeUInt16LE(e.length,4),r.writeUInt16LE(n,6),m.concat([r,e,mt])}function Nt(t){const e=t.readString(4),r=t.readBytes(2).readUInt16LE(),n=t.readBytes(2).readUInt16LE(),i=t.readBytes(r),o=t.readBytes(1);return ft(ht(i)===n,`"${e}" section data does not match checksum"`),ft(mt.equals(o),`"${e}" section is missing terminating null byte`),{title:e,data:i}}function kt({solution:t,width:e},r){return!wt.test(t[r])&&(r%e==0||wt.test(t[r-1]))&&!(r%e==e-1||wt.test(t[r+1]))}function Lt({solution:t,width:e},r){return!wt.test(t[r])&&(r<e||wt.test(t[r-e]))&&!(r>=t.length-e||wt.test(t[r+e]))}function Bt(t){const e={};return 0!=(t&ct.CIRCLED)&&(e.circled=!0),0!=(t&ct.INCORRECT)&&(e.incorrect=!0),0!=(t&ct.PREVIOUSLY_INCORRECT)&&(e.previouslyIncorrect=!0),0!=(t&ct.REVEALED)&&(e.revealed=!0),0!=(t&ct.PENCILED)&&(e.penciled=!0),0!=(t&ct.UNKNOWN_04)&&(e.unknown_04=!0),0!=(t&ct.UNKNOWN_02)&&(e.unknown_02=!0),0!=(t&ct.UNKNOWN_01)&&(e.unknown_01=!0),e}function $t(t,e,r){let n="";for(let i=0;i<r;i+=1)for(let o=0;o<e;o+=1)n+=t[i+o*r];return n}function zt(t){const{fileVersion:e,height:r,isScrambled:n,width:i,solution:o,state:s,clues:u,markupGrid:a,rebus:l}=t;ft(null!=r,'Puzzle is missing required field: "height"'),ft(null!=i,'Puzzle is missing required field: "width"'),ft(null!=o,'Puzzle is missing required field: "solution"'),ft(null!=u,'Puzzle is missing required field: "clues"'),null!=e&&ft(Rt.test(e),"FileVersion must match the supported format: #.#[#]"),ft(o.length===i*r,`Puzzle width & height suggest solution should be ${i*r} characters long. Found ${o.length} characters instead.`),ft(At.test(o),"Puzzle solution may only contain ., :, alphanumeric characters and the following symbols: @, #, $, %, &, +, ?"),null!=s&&(ft(s.length===i*r,`Puzzle width & height suggest state should be ${i*r} characters long. Found ${s.length} characters instead.`),ft([...s].every(((t,e)=>wt.test(t)===wt.test(o[e]))),"Black Squares in solution and state must match"),ft(St.test(s),"Puzzle state may only contain -, ., :, alphanumeric characters and the following symbols: @, #, $, %, &, +, ?"));let c=[...o].reduce(((t,e,r)=>(kt({solution:o,width:i},r)&&(t+=1),Lt({solution:o,width:i},r)&&(t+=1),t)),0);if(ft(c===u.length,`Puzzle solution expects ${c} clues, but found ${u.length} clues`),null!=a&&(ft(a.length===o.length,`Markup grid should match puzzle solution in length. Expected length ${o.length}, but got ${a.length}`),ft(a.every((t=>null!=t&&Object.keys(t).every((t=>dt.includes(t))))),"Markup grid contains unsupported values")),null!=l){if(null!=l.grid){ft(l.grid.length===o.length,`Rebus grid should match puzzle solution in length.  Expected length ${o.length}, but got ${l.grid.length}`);new Set(l.grid.filter((t=>null!=t))).forEach((t=>{var e;ft("string"==typeof(null===(e=l.solution)||void 0===e?void 0:e[t]),`Rebus grid references key that is not found in solution: "${t}"`)}))}null!=l.state&&ft(l.state.length===o.length,`Rebus state should match puzzle solution in length.  Expected length ${o.length}, but got ${l.state.length}`)}}function Dt(t){const{fileVersion:e,solution:r}=t,n=Gt(t),i=Ut(e),o=Pt(t),s=r+n,u=ht(_t(t).subarray(44,52));return ht(m.from(s+o,i),u)}function xt(t){return ht(_t(t).subarray(44,52))}function Yt(t){const e=Ut(t.fileVersion),r=ht(_t(t).subarray(44,52)),n=Pt(t),i=r,o=ht(m.from(t.solution,e)),s=ht(m.from(Gt(t),e)),u=ht(m.from(n,e)),a=Uint8Array.from([255&i,255&o,255&s,255&u,i>>8,o>>8,s>>8,u>>8],((t,e)=>t^yt[e]));return m.from(a)}function jt(t){return t.solution.replace(/[^.:]/g,"-")}function Gt(t){var e;return null!==(e=t.state)&&void 0!==e?e:jt(t)}function Mt(t){var e;return null!=(null===(e=t.rebus)||void 0===e?void 0:e.solution)&&Object.keys(t.rebus.solution).length>0}function Ft(t){var e;return null!=(null===(e=t.rebus)||void 0===e?void 0:e.state)&&t.rebus.state.some((t=>null!=t))}class Zt{constructor(t,e,r){this.buffer=t,this.encoding=e,this.cursor=null!=r?r:0}_getNextNullByte(){const t=this.buffer.indexOf(0,this.cursor);return-1===t?this.buffer.length-1:t}hasBytesToRead(){return this.cursor<this.buffer.length}readString(t){const e=this.cursor+t;if(t<=0)return;const r=this.buffer.toString(this.encoding,this.cursor,e);return this.cursor=e,r}readNullTerminatedString(){const t=this._getNextNullByte()-this.cursor,e=this.readString(t);return this.cursor+=1,e}readBytes(t){const e=this.cursor+t;if(t<=0)return;const r=this.buffer.subarray(this.cursor,e);return this.cursor=e,r}readNullTerminatedBytes(){const t=this._getNextNullByte()-this.cursor,e=this.readBytes(t);return this.cursor+=1,e}}function Vt(t){let e;if("0"===t)e=10;else if(/^[0-9]$/.test(t))e=Number.parseInt(t);else if(/^[@#$%&+?]$/.test(t))e={"@":11,"#":12,$:13,"%":14,"&":15,"+":16,"?":17}[t];else if(/^[A-Z]$/.test(t)){e=17+t.charCodeAt(0)-pt+1}else if(/^[a-z]$/.test(t)){e=43+t.charCodeAt(0)-pt+1}return ot(null!=e,`encodeRebusKey: Encountered an invalid character "${t}"`),e-1}var Ht;!function(t){t.TITLE="TITLE",t.AUTHOR="AUTHOR",t.COPYRIGHT="COPYRIGHT",t.SIZE="SIZE",t.GRID="GRID",t.ACROSS="ACROSS",t.DOWN="DOWN",t.NOTEPAD="NOTEPAD",t.REBUS="REBUS"}(Ht||(Ht={}));const Wt=/^\s*\<ACROSS PUZZLE\>\s*$/,Kt=/^\s*\<ACROSS PUZZLE V2\>\s*$/,qt=/^\s*\<(TITLE|AUTHOR|COPYRIGHT|SIZE|GRID|ACROSS|DOWN|NOTEPAD|REBUS)\>\s*$/,Xt=/^[A-Z.:]+/,Jt=/^[A-Za-z0-9@#$%&+?.:]+$/,Qt=/^(\d+)x(\d+)$/,te=/\r\n|\n/,ee=/[a-z]/,re=/^MARK;$/i,ne=/^([A-Za-z0-9@#$%&+?]):([A-Z]+|\[\d+\]):([A-Za-z0-9@#$%&+?])$/;function ie(t,e){ft(1===e.length,`<${t}> section expects exactly one line. Found ${e.length} lines.`)}const oe=/^[0-9]{4}$/;function se(t){const e="string"==typeof t?t:t.toString();return ft(oe.test(e)),e.split("").map((t=>Number.parseInt(t)))}function ue(t){const{height:e,width:r,solution:n}=t;return $t(n,e,r).replace(new RegExp(wt,"g"),"")}function ae(t,e){const{height:r,width:n,solution:i}=t,o=[...e];let s=$t(i,r,n);return s=[...s].map((t=>wt.test(t)?t:o.shift())).join(""),$t(s,r,n)}t.cleanString=function(t){return function(t){let r=[];for(let n of t)n.charCodeAt(0)in e?r.push(e[n.charCodeAt(0)]):r.push(n);return r.join("")}((r={nbsp:" ",amp:"&",quot:'"',lt:"<",gt:">",mdash:"-",vert:"|",diams:"♦",hearts:"♥",spades:"♠",clubs:"♣",bull:"*"},t.replace(/&(nbsp|amp|quot|lt|gt|mdash|vert|diams|hearts|spades|clubs|bull);/g,(function(t,e){return r[e]})).replace(/&#([0-9]+);/gi,(function(t,e){var r=parseInt(e,10);return String.fromCharCode(r)})).replace(/&x([0-9a-f]+);/gi,(function(t,e){var r=parseInt(e,16);return String.fromCharCode(r)}))));var r},t.enumerateClues=function(t){const{clues:e,solution:r}=t;let n=0;const i=e.slice(),o=[],s=[];return[...r].forEach(((e,r)=>{const u=kt(t,r),a=Lt(t,r);(u||a)&&(n+=1),u&&o.push({number:n,clue:i.shift()}),a&&s.push({number:n,clue:i.shift()})})),{across:o,down:s}},t.getBlankState=jt,t.getFileChecksum=Dt,t.getFileEncoding=function(t){return Ut(t.fileVersion)},t.getHeaderChecksum=xt,t.getICheatedChecksum=Yt,t.getState=Gt,t.gridNumbering=function(t){const{solution:e}=t;let r=0;return[...e].map(((e,n)=>{if(kt(t,n)||Lt(t,n))return r+=1,r}))},t.hasRebusSolution=Mt,t.hasRebusState=Ft,t.isCorrect=function(t,e=!1){var r;zt(t),ft(!t.isScrambled,"Please unscramble the puzzle before checking correctness");let n=!1;if(!Mt(t)&&Ft(t))n=!1;else if(e||!Mt(t))n=!0;else{const e=null===(r=t.rebus)||void 0===r?void 0:r.state;n=null!=e&&e.every(((e,r)=>{const n=function(t,e){var r,n,i,o;const s=null===(n=null===(r=t.rebus)||void 0===r?void 0:r.grid)||void 0===n?void 0:n[e];if(s)return null===(o=null===(i=t.rebus)||void 0===i?void 0:i.solution)||void 0===o?void 0:o[s]}(t,r);return null!=n&&e===n}))}const i=t.state===t.solution;return n&&i},t.parseBinaryFile=function(t){let e=m.from(t);const r=e.indexOf(bt,0,"ascii");ft(r>=2,"File does not appear to be an AcrossLite PUZ file");const n=r-2;let i;n>0&&(i=e.subarray(0,n),e=e.subarray(n));const o=e.readUInt16LE(0),s=e.readUInt16LE(14),u=e.subarray(16,24),a=e.toString("ascii",24,28).replace(/\x00/g,""),l=e.readUInt16LE(28),c=e.readUInt16LE(30),f=e.subarray(32,44),h=e.readUInt8(44),d=e.readUInt8(45),p=e.readUInt16LE(46),g=e.readUInt16LE(48),y=e.readUInt16LE(50),b=Ut(a),w=new Zt(e,b,52),E=h*d,v=w.readString(E),R=w.readString(E),A=w.readNullTerminatedString(),S=w.readNullTerminatedString(),I=w.readNullTerminatedString();let T=[];for(let t=0;t<p;t+=1){const t=w.readNullTerminatedString();ft(null!=t,"Failed to read clue from puzzle file"),T.push(t)}const O=w.readNullTerminatedString();let U,P,_;for(;w.hasBytesToRead();){const{title:t,data:e}=Nt(w);switch(t){case"GEXT":U=Array.from(e).map((t=>Bt(t)));break;case"GRBS":{const t=Array.from(e).map((t=>t-1));t.forEach(((e,r)=>{e<0&&delete t[r]})),P=Object.assign(Object.assign({},null!=P?P:{}),{grid:t});break}case"RTBL":{const t=e.toString("ascii"),r=(C=t,ft(Et.test(C),"Rebus table text doesn't match expected format."),C.slice(0,-1).split(";").map((t=>t.split(":"))).reduce(((t,[e,r])=>Object.assign(Object.assign({},t),{[Number.parseInt(e)]:r})),{}));P=Object.assign(Object.assign({},null!=P?P:{}),{solution:r});break}case"RUSR":{let t=e.toString("ascii").slice(0,-1).split("\0");t.forEach(((e,r)=>{""===e&&delete t[r]})),P=Object.assign(Object.assign({},null!=P?P:{}),{state:t});break}case"LTIM":{const t=e.toString("ascii");ft(vt.test(t),"Timer data doesn't match expected format.");const[,r,n]=vt.exec(t);_={secondsElapsed:Number.parseInt(r),isPaused:"1"===n};break}default:console.warn("Unrecognized extension section:",t)}}var C;const N={author:S,copyright:I,fileVersion:a,height:d,isScrambled:Boolean(y),notepad:O,title:A,width:h,solution:v,state:R,clues:T,rebus:P,markupGrid:U,timer:_,misc:{unknown1:l,unknown2:f,puzzleFormat:g,preamble:i,scrambledChecksum:c}};return ft(xt(N)===s,"Header contents don't match checksum.  Please check that you are reading a valid PUZ file."),ft(Dt(N)===o,"File contents don't match checksum (1).  Please check that you are reading a valid PUZ file."),ft(u.equals(Yt(N)),"File contents don't match checksum (2).  Please check that you are reading a valid PUZ file."),N},t.parseTextFile=function(t){var e;const r=t.split(te).filter((t=>""!==t)),n=Wt.test(r[0]),i=Kt.test(r[0]);ft(n||i,"File does not appear to be an Across Lite puzzle description");const o=n?0:1;[Ht.TITLE,Ht.AUTHOR,Ht.COPYRIGHT,Ht.SIZE,Ht.GRID,Ht.ACROSS,Ht.DOWN].forEach((t=>{const e=r.some((e=>new RegExp(`^\\s*\\<${t}\\>\\s*$`).test(e)));ft(e,`File is missing required tag: <${t}>`)}));const s={};let u,a;const l=r.slice(1);for(;l.length>0;){const t=l.shift();ft(qt.test(t),`Couldn't parse file.  Expected section tag, but got: "${t}"`);const[,e]=qt.exec(t),r=[];for(;l.length>0&&!qt.test(l[0]);){const t=l.shift();r.push(t)}switch(e){case Ht.TITLE:ie(e,r),s.title=r[0].trim();break;case Ht.AUTHOR:ie(e,r),s.author=r[0].trim();break;case Ht.COPYRIGHT:ie(e,r),s.copyright=r[0].trim();break;case Ht.SIZE:{ie(e,r);const t=r[0].trim();ft(Qt.test(t),`Puzzle size expected in the format "WIDTHxHEIGHT" (e.g. "15x15"). Received: "${t}"`);const[,n,i]=Qt.exec(t);s.width=Number.parseInt(n),s.height=Number.parseInt(i);break}case Ht.GRID:{const t=r.map((t=>t.trim())),e=1===o?Jt:Xt;ft(t.every((t=>e.test(t))),"<GRID> section contains unsupported characters."),s.solution=t.join("");break}case Ht.ACROSS:u=r.map((t=>t.trim()));break;case Ht.DOWN:a=r.map((t=>t.trim()));break;case Ht.NOTEPAD:s.notepad=r.join("\n");break;case Ht.REBUS:{ft(0!==o,"The <REBUS> tag is not supported in V1 text files.  Consider using the <ACROSS PUZZLE V2> file tag");let t=s.solution;ft(null!=t,"The <REBUS> tag is expected to come after <GRID> in puzzle descriptions");const e=new Array(t.length),n={};r.map((t=>t.trim())).forEach((r=>{if(re.test(r)&&null==s.markupGrid){const e=[...t].map((t=>ee.test(t)?{circled:!0}:{}));e.some((({circled:t})=>t))&&(s.markupGrid=e)}if(ne.test(r)){const[,i,o,s]=ne.exec(r),u=Vt(i);[...t].forEach(((t,r)=>{t===i&&(e[r]=u)})),n[u]=o,t=t.replaceAll(i,s)}})),Object.keys(n).length>0&&(s.solution=t,s.rebus={grid:e,solution:n});break}default:throw new Error(`Unhandled section tag: ${t}`)}}s.solution=null===(e=s.solution)||void 0===e?void 0:e.toUpperCase();const{width:c,solution:f}=s;return null!=c&&null!=f&&null!=u&&null!=a&&(s.clues=function({solution:t,width:e},r,n){const i=r.slice(),o=n.slice(),s=[];return[...t].forEach(((r,n)=>{kt({solution:t,width:e},n)&&s.push(i.shift()),Lt({solution:t,width:e},n)&&s.push(o.shift())})),s}({width:c,solution:f},u,a)),zt(s),s},t.printBinaryFile=function(t){var e,r,n,i,o,s;zt(t);const u=Ut(t.fileVersion),a=t.solution+Gt(t),l=`${null!==(e=t.title)&&void 0!==e?e:""}\0${null!==(r=t.author)&&void 0!==r?r:""}\0${null!==(n=t.copyright)&&void 0!==n?n:""}\0`,c=t.clues.join("\0")+"\0",f=`${null!==(i=t.notepad)&&void 0!==i?i:""}\0`,h=m.from(a+l+c+f,u),d=_t(t),p=Dt(t),g=xt(t),y=Yt(t);d.writeUInt16LE(p,0),d.writeUInt16LE(g,14),m.from(y).copy(d,16);let b=gt,w=gt,E=gt;if(t.rebus){if(t.rebus.grid){const e=Uint8Array.from(t.rebus.grid,(t=>null==t?0:t+1)),r=m.alloc(e.length);for(let t=0;t<e.length;t++)r.writeUInt8(e[t],t);b=Ct("GRBS",r)}if(t.rebus.solution){w=Ct("RTBL",m.from((v=t.rebus.solution,Object.entries(v).reduce(((t,[e,r])=>`${t}${e.padStart(2," ")}:${r};`),"")),"ascii"))}if(t.rebus.state){const e=t.rebus.state.map((t=>null==t?"":t)).join("\0")+"\0";E=Ct("RUSR",m.from(e,"ascii"))}}var v;let R=gt;if(null!=t.timer){R=Ct("LTIM",m.from(`${t.timer.secondsElapsed},${t.timer.isPaused?1:0}`,"ascii"))}let A=gt;if(null!=t.markupGrid){const e=Uint8Array.from(t.markupGrid,(t=>function({circled:t,incorrect:e,previouslyIncorrect:r,revealed:n,penciled:i,unknown_04:o,unknown_02:s,unknown_01:u}={}){return(t?ct.CIRCLED:0)+(e?ct.INCORRECT:0)+(r?ct.PREVIOUSLY_INCORRECT:0)+(n?ct.REVEALED:0)+(i?ct.PENCILED:0)+(o?ct.UNKNOWN_04:0)+(s?ct.UNKNOWN_02:0)+(u?ct.UNKNOWN_01:0)}(t))),r=m.alloc(e.length);for(let t=0;t<e.length;t++)r.writeUInt8(e[t],t);A=Ct("GEXT",r)}return m.concat([null!==(s=null===(o=null==t?void 0:t.misc)||void 0===o?void 0:o.preamble)&&void 0!==s?s:gt,d,h,b,w,R,A,E])},t.printTextFile=function(t,e="\t",r="Unix"){var n;zt(t);const i="Windows"===r?"\r\n":"\n";function o(t){return`${e}${null!=t?t:""}${i}`}const{markupGrid:s,rebus:u}=t,a=null!=s||null!=u;let l=t.solution,c=[];if(null!=s&&(l=l.split("").map(((t,e)=>s[e].circled?t.toLowerCase():t)).join("")),null!=(null==u?void 0:u.grid)&&null!=(null==u?void 0:u.solution)){const{rebusGrid:t,rebusSolution:e}=function(t,e){const r=Object.keys(e).map((t=>Number.parseInt(t))).sort(((t,e)=>t-e)),n=function(t,e){const r=[];let n=t;for(;n<e;)r.push(n),n+=1;return r}(0,r.length);if(n.every(((t,e)=>t===r[e])))return{rebusGrid:t,rebusSolution:e};function i(t){return t&&n[r.indexOf(t)]}return{rebusGrid:t.map((t=>i(t))),rebusSolution:Object.fromEntries(Object.entries(e).map((([t,e])=>[i(Number.parseInt(t)),e])))}}(u.grid,u.solution);Object.entries(e).forEach((([e,r])=>{let n,i=[];const o=Number.parseInt(e);ft(!Number.isNaN(o),`Encoded rebus keys should be numeric. Found: ${e}`);const s=function(t){if(1<=(t+=1)&&t<=9)return t.toString();if(10===t)return"0";if(11<=t&&t<=17)return{11:"@",12:"#",13:"$",14:"%",15:"&",16:"+",17:"?"}[t];throw new it(`encodeRebusKey: Encountered an unsupported rebus key "${t}"`)}(o);t.forEach(((t,e)=>{t===o&&(i.push(e),null==n&&(n=l[e]),ft(n===l[e],"Text format cannot encode multiple short solutions for a single rebus substitution"))})),ft(null!=n&&i.length>0,`Rebus solutions should have at least one corresponding grid entry. Key: ${e} Grid: ${t}`),l=l.split("").map(((t,e)=>i.includes(e)?s:t)).join(""),c.push(`${s}:${r}:${n}`)}))}let f="";f+="<ACROSS PUZZLE V2>"+i,f+="<TITLE>"+i,f+=o(t.title),f+="<AUTHOR>"+i,f+=o(t.author),f+="<COPYRIGHT>"+i,f+=o(t.copyright),f+="<SIZE>"+i,f+=o(`${t.width}x${t.height}`),f+="<GRID>"+i,l.match(new RegExp(`.{${t.width}}`,"g")).forEach((t=>{f+=o(t)})),a&&(f+="<REBUS>"+i,(null===(n=t.markupGrid)||void 0===n?void 0:n.some((({circled:t})=>t)))&&(f+=o("MARK;")),c.forEach((t=>{f+=o(t)})));const{across:h,down:d}=function(t){const{clues:e,solution:r}=t,n=e.slice(),i=[],o=[];return[...r].forEach(((e,r)=>{kt(t,r)&&i.push(n.shift()),Lt(t,r)&&o.push(n.shift())})),{across:i,down:o}}(t);return f+="<ACROSS>"+i,h.forEach((t=>f+=o(t))),f+="<DOWN>"+i,d.forEach((t=>f+=o(t))),null!=t.notepad&&(f+="<NOTEPAD>"+i,f+=t.notepad+i),f},t.scramble=function(t,e){zt(t),ft(!t.isScrambled,"Puzzle is already scrambled!");const r=ue(t),n=r.length;ft(/^[A-Z]+$/.test(r),"Scrambling a puzzle that has non-alphabetical characters in the solution is not supported."),ft(n>=12,`Scrambling is not supported for puzzles with less than 12 characters. Found ${n} characters.`);const i=ht(m.from(r,"ascii")),o=ae(t,function(t,e){const r=se(e),n=t.length,i=t.split("").map((t=>t.charCodeAt(0)-pt));let o=i.slice(),s=-1;for(let t=0;t<n;t+=1){for(s+=16;s>=n;)s-=1|n;i[s]=o[t]}for(let t=0;t<4;t+=1){let e=Math.pow(2,4-t),s=-1;for(let t=0;t<n;t+=1){for(s+=e;s>=n;)s-=1|n;i[s]=(i[s]+r[t%4])%26}e>n&&(e-=1|n);for(let s=0;s<r[t];s+=1){o=[];for(let t=0;t<e;t+=1)o.push(i.shift());if(n%2==0){const t=o.pop();o.unshift(t)}i.push(...o)}}return i.filter((t=>null!=t)).map((t=>String.fromCharCode(t+pt))).join("")}(r,e));return Object.assign(Object.assign({},t),{solution:o,isScrambled:!0,misc:Object.assign(Object.assign({},t.misc),{scrambledChecksum:i})})},t.unscramble=function(t,e){var r;zt(t),ft(t.isScrambled,"Puzzle is not scrambled!"),ft(null===(r=t.misc)||void 0===r?void 0:r.scrambledChecksum,"This puzzle appears to be scrambled, but is missing a checksum.");const n=function(t,e){const r=se(e),n=t.length,i=t.split("").map((t=>t.charCodeAt(0)-pt));let o=[];for(let t=3;t>=0;t-=1){let e=Math.pow(2,4-t);e>n&&(e-=1|n);for(let s=0;s<r[t];s+=1){o=[];for(let t=0;t<e;t+=1)o.unshift(i.pop());if(n%2==0){const t=o.shift();o.push(t)}i.unshift(...o)}let s=-1;for(let e=0;e<n;e+=1){for(s+=Math.pow(2,4-t);s>=n;)s-=1|n;i[s]=(i[s]-r[e%4]+26)%26}}o=i.slice();let s=-1;for(let t=0;t<n;t+=1){for(s+=16;s>=n;)s-=1|n;i[t]=o[s]}return i.filter((t=>null!=t)).map((t=>String.fromCharCode(t+pt))).join("")}(ue(t),e);ft(t.misc.scrambledChecksum===ht(m.from(n,"ascii")));const i=ae(t,n);return Object.assign(Object.assign({},t),{solution:i,isScrambled:!1,misc:Object.assign(Object.assign({},t.misc),{scrambledChecksum:void 0})})},t.validate=zt,Object.defineProperty(t,"__esModule",{value:!0})}));},{}]},{},[1])(1)});