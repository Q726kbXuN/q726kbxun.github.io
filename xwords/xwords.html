<!DOCTYPE html><html><head><script src="xwords_puz.js"></script><title>Crosswords</title><link rel="icon" type="image/png" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAABd0lEQVQ4y62Tz0pbURCHv3NyormXqIm1WGyyK/oEBv8ssskjlBYhdFN9kbyGbkK76qa0S0UFUZcREd/ggAtpyc1tDiHhnummtKb3JrrwB7M5M/PxG2aO6na70ul0qFQqiAj/y1rL/v4BIPgkIVUxGo2k1WqJ1lrCMEzF+npNzk8P5eLiUn7EfXHOjYUxxqCUwnuPcy7lQKmEwTChFGiMmSUo5Mbyhkc0HCbUNrcpFosopVJ5zROklMpsfjJgmp4HMMkegPd+at5Uq1Xq9Trfv31lMBSWl5d4WO6cw1pLPp/PBlhrKS3Ms7b6hrv7iI2tLWZy/xBRFBGG4USABtBas/RyherrFWL3C/DcXN9mDcRV5zoNMPkZFl8sEgYFfvb7gOfk+CzdL57jo6Mph6Tgy+dPvCrNEblBpmWZtkYReNf8wMfdPeYK2TP7JJnsoFwus/CH+37nbcZJ5thpNsef2u229Ho9Go1G5neO45ggCDDG/D3rh3W/AeKYlnvZbYpFAAAAAElFTkSuQmCC"/><style>body {background-color: #333;color: #fff;}select {color: #eef;background-color: #114;font-size: 12pt;border-radius: 5px;padding-left: 5px;margin-left: 5px;}.hidden {display: none;}a {color: #99f;text-decoration: none;}a:hover {text-decoration: underline;}.stats {font-size: 70%;}.clickable {cursor: pointer;}.pad {width: 1em;display: inline-block;}.clickable:hover {text-decoration: underline;}.clues {max-height: 600px;overflow-y: auto;}.ClueCell {cursor: pointer;padding-left: 2em;position: relative;}.ClueCellHighlight {cursor: pointer;padding-left: 2em;position: relative;background-color: #ff0;color: #000;}.num {left: 0em;width: 1.5em;text-align: right;font-weight: bold;position: absolute;}.Cell {fill: #fff;}.Cell:focus {outline: none;}.CellHighlight {fill: #ff0;}.CellHighlight:focus {outline: none;}.Board {display: block;font-family: arial,sans-serif;user-select: none;}</style><script>let xwords = null;let header = null;let allAnswers = null;let allClues = null;let currentView = null;function downloadURL(data, fileName) {const a = document.createElement('a');a.href = data;a.download = fileName;document.body.appendChild(a);a.style.display = 'none';a.click();a.remove();}function downloadBlob(data, fileName, mimeType) {const blob = new Blob([data], {type: mimeType});const url = window.URL.createObjectURL(blob);downloadURL(url, fileName);setTimeout(() => window.URL.revokeObjectURL(url), 1000);}function downloadPuz() {let p = {"width": currentView['width'],"height": currentView['height'],"fileVersion": "1.2c","solution": "","state": "","clues": [],};let txt = document.createElement("textarea");let rebus = {"grid": [], "solution": {}};let rebusUsed = false;for (let y = 0; y < p['height']; y++) {for (let x = 0; x < p['width']; x++) {const cell = currentView['cells'][y][x];if ("flags" in cell && cell["flags"] == "box") {p["solution"] += ".";p["state"] += ".";rebus['grid'].push(null);} else {if (cell['value'].length > 1) {rebusUsed = true;let rebusID = null;for (const [key, value] of Object.entries(rebus['solution'])) {if (cell['value'] == value) {rebusID = parseInt(key);}}if (rebusID == null) {rebusID = Object.keys(rebus['solution']).length + 1;rebus['solution'][rebusID] = cell['value'];}rebus['grid'].push(rebusID);} else {rebus['grid'].push(null);}let solution = cell['value'].charAt(0).toUpperCase();if (/[^A-Z0-9@#$%&?+]$/.test(solution)) {console.log("Possible issue! [" + solution + "]");}p["solution"] += solution;p["state"] += "-";for (let section of ['Across', 'Down']) {for (let clue of currentView['clues']) {if (clue['section'] == section && clue['cell'][0] == x && clue['cell'][1] == y) {txt.innerText = clue['clue'];p['clues'].push(puz.cleanString(clue['clue']));}}}}}}if (rebusUsed) {p["rebus"] = rebus;}let data = puz.printBinaryFile(p);let fn = "";fn += document.getElementById("xword").value + " - ";fn += document.getElementById("year").value + "-";fn += document.getElementById("month").value + "-";fn += document.getElementById("day").value;downloadBlob(data, fn + '.puz', 'application/octet-stream');}function renderData(temp) {temp = {"width": temp[0],"height": temp[1],"cells": temp[2],"clues": temp[3],"is_problem": (temp.length >= 5 ? temp[4] : false),"desc": (temp.length >= 6 ? temp[5] : ""),};currentView = temp;let new_cells = [];for (let row of temp['cells']) {new_cells.push([]);for (let cell of row) {new_cells[new_cells.length-1].push(cell === 0 ? {"flags": "box"} : {"value": cell});}}temp['cells'] = new_cells;let new_clues = [];for (let clue of temp['clues']) {new_clues.push({"clue": clue[0],"section": clue[1] === 0 ? "Across" : "Down","num": clue[2],"cell": [clue[3], clue[4]],"cells": clue.slice(3),});temp['cells'][clue[4]][clue[3]]['clueNum'] = clue[2];}temp['clues'] = new_clues;let html = '';html += '<table>';html += '<tr id="reveal"><td colspan=5 align="right"><i>(click to reveal answer)</i></td></tr>';html += '<tr><td valign="top" align="center">';html += '<svg width="' + (temp['width'] * 30) + 'px" class="Board" ';html += 'preserveAspectRatio="xMidYMin meet" aria-labelledby="boardTitle" ';html += 'aria-describedby="boardDesc" xmlns="http://www.w3.org/2000/svg" ';html += 'viewBox="0 0 ' + (temp['width'] * 33 + 6) + ' ' + (temp['height'] * 33 + 6) + '">';html += '<title id="boardTitle">Puzzle Board</title>';html += '<desc id="boardDesc">Game Board for the Crossword</desc>';html += '<use xlink:href="#checked"></use>';html += '<g data-group="cells" role="table">';let tab = 0;let reverse = [];for (let yi = 0; yi < temp['height']; yi++) {reverse.push([]);for (let xi = 0; xi < temp['width']; xi++) {reverse[reverse.length-1].push([]);}}let clueNum = 0;for (let section of ['Across', 'Down']) {for (let clue of temp['clues']) {if (clue['section'] == section) {for (let i = 0; i < clue['cells'].length; i += 2) {let x = clue['cells'][i], y = clue['cells'][i+1];reverse[y][x].push(clueNum);}clueNum++;}}}allAnswers = {};let lastClue = 0;for (let yi = 0; yi < temp['height']; yi++) {let y = 3 + 33 * yi;for (let xi = 0; xi < temp['width']; xi++) {let x = 3 + 33 * xi;const cell = temp['cells'][yi][xi];if ("flags" in cell && cell["flags"] == "box") {html += '<g';if (temp['desc'] == 'diagramless') {html += ' class="hidden"';}html += '><rect role="cell" tabindex="-1"';html += ' x="' + x + '" y="' + y + '"';html += ' width="33" height="33">';html += '</rect></g>';} else {let answer = cell['value'];let clue_num = '';if (temp['desc'] == 'acrostic') {lastClue++;clue_num += lastClue;} else {if ('clueNum' in cell) {clue_num = cell['clueNum'];}}let key = xi + "," + yi;allAnswers[key] = answer;html += '<g';if (temp['desc'] == 'diagramless') {html += ' class="hidden"';}html += ' onmouseover="highlight(true, ' + JSON.stringify(reverse[yi][xi]) + ', \'CellHighlight\');"';html += ' onmouseout="highlight(false, ' +  JSON.stringify(reverse[yi][xi]) + ', \'Cell\');"';html += ' onclick="reveal(' +  JSON.stringify(reverse[yi][xi]) + ');"';html += '>';html += '<rect id="c' + key + '" role="cell" tabindex="' + tab + '"';html += ' class="Cell" x="' + x + '"';html += ' y="' + y + '" width="33" height="33">';html += '</rect>';html += '<text x="' + (x + 2) + '" y="' + (y + 11.50) + '"';html += ' text-anchor="start" font-size="11">';html += clue_num;html += '</text>';html += '<text id="t' + key + '"';html += ' x="' + (x + 16.5) + '" y="' + (y + 30.25) + '"';html += ' text-anchor="middle" font-size="';html += ((22 * 2) / Math.max(2, answer.length)) + '">';html += '</text>';html += '</g>';tab += 1;}}}let path = '';for (let x = 1; x < temp['width']; x++) {path += 'M' + (x * 33 + 3) + ',3l0,' + (temp['height'] * 33);}for (let y = 1; y < temp['height']; y++) {path += 'M3,' + (y * 33 + 3) + 'l' + (temp['width'] * 33) + ',0';}html += '<g data-group="grid">';html += '<path d="' + path + '" stroke="dimgray" ';html += 'vector-effect="non-scaling-stroke"></path>';html += '<rect x="1.50" y="1.50" width="' + (temp['width'] * 33 + 3) + '" ';html += 'height="' + (temp['height'] * 33 + 3) + '" ';html += 'stroke="black" stroke-width="3" fill="none"></rect>';html += '</g>';html += '</svg>';html += '<br>';html += '<span id="download">';html += '<span class="clickable" style="float:left" onclick="revealAll();">Reveal all</span>';html += '<span class="pad"></span>';if (!temp['is_problem']) {html += '<span class="clickable hideme" style="float:right" onclick="downloadPuz();">Download .puz file</span>';}html += "</span>";allClues = [];for (let section of ['Across'].concat(temp['desc'] == 'acrostic' ? [] : ['Down'])) {html += '</td><td width="10px">';html += '</td><td valign="top" width="250px">' + section + ':<br>';html += '<div class="clues">';for (let clue of temp['clues']) {if (clue['section'] == section) {html += '<div class="ClueCell"';html += ' onmouseover="highlight(true, [' + allClues.length + '], \'CellHighlight\');"';html += ' onmouseout="highlight(false, [' + allClues.length + '], \'Cell\');"';html += ' onclick="reveal([' + allClues.length + ']);"';html += ' id="a' + allClues.length + '">';html += '<span class="num">';html += clue['num'];html += '</span>';html += clue['clue'] + '<br>';html += '</div>';allClues.push(clue['cells']);}}html += "</div>";}html += '</td></tr></table>';document.getElementById("xword_view").innerHTML = html;}function revealAll() {for (const [key, value] of Object.entries(allClues)) {reveal([key]);}}function reveal(vals) {for (const cur of vals) {const cells = allClues[cur];for (let i = 0; i < cells.length; i += 2) {let x = cells[i], y = cells[i+1];document.getElementById("t" + x + "," + y).innerHTML = allAnswers[x + "," + y];document.getElementById("t" + x + "," + y).parentElement.className.baseVal = '';}}}function highlight(focusItem, ids, className) {for (let id of ids) {const cells = allClues[id];document.getElementById("a" + id).className = "Clue" + className;document.getElementById("a" + id).scrollIntoView({behavior: 'smooth', block: "nearest"});for (let i = 0; i < cells.length; i += 2) {let x = cells[i], y = cells[i+1];document.getElementById("c" + x + "," + y).className.baseVal = className;}}}async function getData(data_num, start, len, loadMode='gzipDecode') {const resp = await fetch("./xwords_data_" + String(data_num).padStart(2, '0') + ".dat",{'headers': {'Range': 'bytes=' + start + "-" + (start + len - 1),},},);if (loadMode == 'gzipDecode') {const blob = new Blob([header, await resp.blob()]);const ds = new DecompressionStream("gzip");const decomp = blob.stream().pipeThrough(ds);const decoded = await new Response(decomp).blob();const text = await decoded.text();const parsed = JSON.parse(text);return parsed;} else if (loadMode == 'rawData') {const asBlob = await resp.blob();return asBlob;} else if (loadMode == 'json') {const text = await resp.text();const parsed = JSON.parse(text);return parsed;}}function loadPuzzle(info) {getData(...info).then(data => {renderData(data);let uri = window.location.href.split("#")[0];uri += '#' + document.getElementById('xword').value.replace(' ', '+');uri += '/' + document.getElementById('year').value;uri += '-' + document.getElementById('month').value;uri += '-' + document.getElementById('day').value;window.location.href = uri;});}function fillOut(dest, source) {let elem = document.getElementById(dest);elem.replaceChildren();let items = Object.keys(source).sort(function (a, b) {a = a.replace(/^(A|An|The) /,"");b = b.replace(/^(A|An|The) /,"");if (dest == "day") {if (!a.includes("-")) { a += "-normal"; }if (!b.includes("-")) { b += "-normal"; }}return a.toLowerCase().localeCompare(b.toLowerCase());});for (let cur of items) {let opt = document.createElement('option');opt.value = cur;opt.innerText = cur;elem.appendChild(opt);}elem.value = items.slice((dest!='xword')?-1:0)[0];if (dest == 'xword') {showCount("count_xword", source[elem.value], 3);fillOut('year', source[elem.value]);} else if (dest == 'year') {showCount("count_year", source[elem.value], 2);fillOut('month', source[elem.value]);} else if (dest == 'month') {showCount("count_month", source[elem.value], 1);fillOut('day', source[elem.value]);} else if (dest == 'day') {loadPuzzle(source[elem.value]);}}function change(dest) {let temp = xwords;if (['xword', 'year', 'month', 'day'].includes(dest)) { temp = temp[document.getElementById('xword').value]; }if (['year', 'month', 'day'].includes(dest)) { temp = temp[document.getElementById('year').value]; }if (['month', 'day'].includes(dest)) { temp = temp[document.getElementById('month').value]; }if (['day'].includes(dest)) { temp = temp[document.getElementById('day').value]; }if (dest == 'xword') {showCount("count_xword", temp, 3);fillOut('year', temp);} else if (dest == 'year') {showCount("count_year", temp, 2);fillOut('month', temp);} else if (dest == 'month') {showCount("count_month", temp, 1);fillOut('day', temp);} else if (dest == 'day') {loadPuzzle(temp);}}async function mainStart() {const loc = await getData(0, 22, 78, loadMode='json');header = await getData(...loc.slice(5,8), loadMode='rawData');const data = await getData(...loc.slice(2,5));return [data, loc[1]];}function getCount(values, depth) {let ret = 0;for (const [key, value] of Object.entries(values)) {ret += depth == 1 ? 1 : getCount(value, depth - 1);}return ret;}function withCommas(value) {return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");}function showCount(dest, values, depth) {/* document.getElementById(dest).innerText = withCommas(getCount(values, depth)); */}function showStats(created, total) {document.getElementById('stats').innerText = `Created ${created} with ${withCommas(total)} puzzles`;}let hidden = false;document.addEventListener("keydown", function(e) {if (e.key == 'h') {for (let elem of ['reveal', 'download', 'widgets', 'footer']) {elem = document.getElementById(elem);if (hidden) {elem.style.display = elem.old_display;} else {elem.old_display = elem.style.display;elem.style.display = 'none';}}hidden = !hidden;}});document.addEventListener("DOMContentLoaded", function(event) {mainStart().then(([data, created]) => {let hash = window.location.hash;xwords = data;showStats(created, getCount(xwords, 4));showCount("count_total", xwords, 4);for (let key of ["xword", "year", "month", "day"]) {document.getElementById(key).style = '';}fillOut('xword', xwords);if (hash.length > 1) {hash = hash.substring(1).replace("+", " ");hash = hash.split("/");hash = hash.slice(0, 1).concat(hash[1].split("-"));hash = hash.slice(0, 3).concat(hash.slice(3).join("-"));if (hash.length == 4) {document.getElementById('xword').value = hash[0];change("xword");document.getElementById('year').value = hash[1];change("year");document.getElementById('month').value = hash[2];change("month");document.getElementById('day').value = hash[3];change("day");}}}).catch(e => {alert("Unable to load data, sorry.")});});</script></head><body><table><tr id="widgets"><td><select id="xword" onchange="change('xword');" style="display: none;"></select></td><td><select id="year" onchange="change('year');" style="display: none;"></select></td><td><select id="month" onchange="change('month');" style="display: none;"></select></td><td><select id="day" onchange="change('day');" style="display: none;"></select></td></tr></table><table><tr><td valign="top"><span id="xword_view"></span><br></td></tr><tr id="footer"><td><span class="stats" id="stats">Loading...</span><span class="stats">, please see <a href="https://github.com/Q726kbXuN/q726kbxun.github.io/blob/main/xwords/view_archive.py">this example</a> to load this data from Python.</span></td></tr></table></body></html>